<!-- User form -->
<div class="relative flex flex-auto flex-col items-center px-6 sm:px-12">
    <div class="w-full max-w-3xl">
        <form [formGroup]="contactForm">
            <!-- Avatar -->
            <div class="-mt-16 flex flex-auto items-end">
                <div
                    class="ring-bg-card relative flex h-32 w-32 items-center justify-center overflow-hidden rounded-full ring-4"
                >
                    <!-- Upload / Remove avatar -->
                    <div
                        class="absolute inset-0 z-10 bg-black bg-opacity-50"
                    ></div>
                    <div
                        class="absolute inset-0 z-20 flex items-center justify-center"
                    >
                        <div>
                            <input
                                id="avatar-file-input"
                                class="pointer-events-none invisible absolute h-0 w-0 opacity-0"
                                type="file"
                                [multiple]="false"
                                [accept]="'image/jpeg, image/png'"
                                (change)="uploadAvatar(avatarFileInput.files)"
                                #avatarFileInput
                            />
                            <label
                                class="flex h-10 w-10 cursor-pointer items-center justify-center rounded-full hover:bg-hover"
                                for="avatar-file-input"
                                matRipple
                            >
                                <mat-icon
                                    class="text-white"
                                    [svgIcon]="'heroicons_outline:camera'"
                                ></mat-icon>
                            </label>
                        </div>
                        <div>
                            <button mat-icon-button (click)="removeAvatar()">
                                <mat-icon
                                    class="text-white"
                                    [svgIcon]="'heroicons_outline:trash'"
                                ></mat-icon>
                            </button>
                        </div>
                    </div>
                    <!-- Image/Letter -->
                    @if (contactForm.get('avatarUrl')?.value) {
                        <app-image
                            [class]="'h-full w-full object-cover object-left'"
                            [src]="contactForm.get('avatarUrl')?.value"
                        />
                    }
                    @if (!contactForm.get('avatarUrl')?.value) {
                        <div
                            class="flex h-full w-full items-center justify-center overflow-hidden rounded bg-gray-200 text-8xl font-bold uppercase leading-none text-gray-600 dark:bg-gray-700 dark:text-gray-200"
                        >
                            {{ user?.name.charAt(0) }}
                        </div>
                    }
                </div>
            </div>

            <!-- Name -->
            <div class="mt-8">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Name</mat-label>
                    <mat-icon
                        matPrefix
                        class="hidden icon-size-5 sm:flex"
                        [svgIcon]="'heroicons_solid:user-circle'"
                    ></mat-icon>
                    <input
                        matInput
                        [formControlName]="'name'"
                        [placeholder]="'Name'"
                        [spellcheck]="false"
                    />
                </mat-form-field>
            </div>

            <div class="mt-8">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Email</mat-label>
                    <mat-icon
                        matPrefix
                        class="hidden icon-size-5 sm:flex"
                        [svgIcon]="'heroicons_solid:envelope'"
                    ></mat-icon>
                    <input
                        matInput
                        [formControlName]="'email'"
                        [placeholder]="'Email'"
                        [spellcheck]="false"
                    />
                </mat-form-field>
            </div>

            <div class="mt-8">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Password</mat-label>
                    <mat-icon
                        matPrefix
                        class="hidden icon-size-5 sm:flex"
                        [svgIcon]="'heroicons_solid:lock-closed'"
                    ></mat-icon>
                    <input
                        matInput
                        [formControlName]="'password'"
                        [placeholder]="'Password'"
                        [spellcheck]="false"
                        type="password"
                    />
                </mat-form-field>
            </div>

            <div class="mt-8">
                <mat-form-field class="w-full" [subscriptSizing]="'dynamic'">
                    <mat-label>Phone Number</mat-label>
                    <mat-icon
                        matPrefix
                        class="hidden icon-size-5 sm:flex"
                        [svgIcon]="'heroicons_solid:phone'"
                    ></mat-icon>
                    <input
                        matInput
                        [formControlName]="'phone'"
                        [placeholder]="'Phone Number'"
                        [spellcheck]="false"
                    />
                </mat-form-field>
            </div>
            @if (type !== 'admin') {
                <div class="mt-8">
                    <mat-form-field
                        class="w-full"
                        [subscriptSizing]="'dynamic'"
                    >
                        <mat-label>Secondary Phone Number</mat-label>
                        <mat-icon
                            matPrefix
                            class="hidden icon-size-5 sm:flex"
                            [svgIcon]="'heroicons_solid:phone'"
                        ></mat-icon>
                        <input
                            matInput
                            [formControlName]="'secondPhone'"
                            [placeholder]="'Secondary Phone Number'"
                            [spellcheck]="false"
                        />
                    </mat-form-field>
                </div>
            }
            @if (type === 'admin') {
                <div class="mt-8 flex flex-col gap-y-2">
                    <mat-label class="font-medium">Role</mat-label>

                    <app-dropdown
                        [options]="rolesList"
                        [(selectedValue)]="role"
                        [placeholder]="'Select Role'"
                        (selectionChange)="onRoleChange($event)"
                    ></app-dropdown>
                </div>
            }
            @if (type !== 'admin' && !isNewUser) {
                <div class="mt-4">
                    @if (!addNationality && !selectedNationality) {
                        <button
                            mat-button
                            class="mt-3 rounded-full bg-blue-900 px-4 py-2 text-white hover:bg-blue-950"
                            (click)="toggleNationality()"
                        >
                            <mat-icon
                                [svgIcon]="'heroicons_outline:plus'"
                                class="text-white"
                            />
                            Add nationality
                        </button>
                    } @else {
                        <div class="flex flex-col gap-y-3">
                            <div class="flex flex-col gap-y-1">
                                <mat-label class="font-medium"
                                    >Nationality</mat-label
                                >
                                <app-dropdown
                                    [options]="nationalities"
                                    [(selectedValue)]="selectedNationality"
                                    [placeholder]="'Select Nationality'"
                                    (selectionChange)="
                                        onNationalityChange($event)
                                    "
                                ></app-dropdown>
                            </div>

                            <app-file-upload
                                *ngIf="selectedNationality"
                                [maxFiles]="5"
                                [uploadedDocs]="uploadedFiles"
                                (uploadComplete)="onUploadComplete($event)"
                            ></app-file-upload>
                            <div class="flex w-full justify-end">
                                <button
                                    mat-button
                                    (click)="saveNationality()"
                                    class="mt-3 w-fit rounded-full bg-blue-900 px-4 py-2 text-white hover:bg-blue-950"
                                >
                                    Save Nationality
                                </button>
                            </div>
                        </div>
                    }
                </div>
            }

            <!-- Actions -->
            <div
                class="-mx-6 mt-10 flex items-center border-t bg-gray-50 py-4 pl-1 pr-4 dark:bg-transparent sm:-mx-12 sm:pl-7 sm:pr-12"
            >
                <!-- Delete -->
                <button
                    mat-button
                    [color]="'warn'"
                    [matTooltip]="'Delete'"
                    (click)="deleteContact()"
                >
                    Delete
                </button>
                <!-- Cancel -->
                <button
                    class="ml-auto"
                    mat-button
                    [matTooltip]="'Cancel'"
                    (click)="toggleEditMode(false)"
                >
                    Cancel
                </button>
                <!-- Save -->
                <button
                    class="ml-2"
                    mat-flat-button
                    [color]="'primary'"
                    [disabled]="contactForm.invalid"
                    [matTooltip]="'Save'"
                    (click)="updateContact()"
                >
                    Save
                </button>
            </div>
        </form>
    </div>
</div>
